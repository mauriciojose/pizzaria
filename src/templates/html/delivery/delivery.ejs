<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caixa</title>
    <link rel="stylesheet" type="text/css" href="/templates/css/estilo.css">
    <link rel="stylesheet" type="text/css" href="/templates/css/delivery.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


</head>

<body>

    <input type="hidden" name="idMesa" id="idMesa" value="dMesa">
    <input type="hidden" name="idCaixa" id="idCaixa" value="">
    <h2>Lista de Pedidos</h2>
    <div class="caixa">
        <!-- <div class="logo">
            <img id="cliente" src="/img/mesa.png" alt="">
        </div> -->

        <div style="overflow-y: scroll;" class="">

            <table>
                <thead>
                    <th>Cliente</th>
                    <th>Entrega</th>
                    <th>Telefone</th>
                    <th>Endereço</th>
                    <th>Status</th>
                    <th colspan="2">Ações</th>
                </thead>
                <tbody>
                    <% caixas.forEach(function(caixa){%>
                        <% if(caixa.isDelivery){%>
                            <tr class='clickable-row'>

                                <td data-title="Cliente">
                                    <%=caixa.client.name%>
                                </td>
                                <td data-title="Data Pedido">
                                    <%=caixa.dateOpen.getDate()+'/'+(caixa.dateOpen.getMonth()+1)+'/'+caixa.dateOpen.getFullYear()%>
                                </td>
                                <td data-title="Telefone">
                                    <%=caixa.client.telefone1%>
                                </td>
                                <td data-title="Endereço">
                                    <%=caixa.client.endereco%>
                                </td>
                                <td data-title="Status">
                                    <% if(caixa.status==0){%>
                                        Aberto
                                        <% }else{%>
                                            fechado
                                            <%}%>
                                </td>
                                <% if(caixa.status==0){%>
                                    <td><button onclick="add('<%=caixa._id%>')">Adicionar</button></td>
                                    <td><button onclick="caixa('<%=caixa._id%>')">Visualizar</button></td>
                                    <td><button onclick="FinalizarPedido('<%=caixa._id%>')">Finalizar</button></td>
                                    <% }else{%>
                                        <td><button disabled onclick="add('<%=caixa._id%>')">Adicionar</button></td>
                                        <td><button onclick="caixa('<%=caixa._id%>')">Visualizar</button></td>
                                        <td><button disabled onclick="FinalizarPedido('<%=caixa._id%>')">Finalizar</button></td>
                                        <%}%>
                            </tr>
                            <% }%>
                                <%
                    }); %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="container">
        <!-- 
        <div style="display: flex;margin-left: 8%;margin-top: 2%;">
            <label style="margin-right: 5px;">SubTotal: <input type="text" readonly disabled name="" class="input" id="subtotal"></label>
        </div> -->


        <!-- </form> -->
        <a onclick="showClickHandler('12')">
            <div class="float-button">
                <span>+</span>
            </div>
        </a>
    </div>
    <div class="info">
        <center>
            <p>Clicle no pedido para inserir o produto</p>
        </center>
    </div>



</body>


</html>
<div class="modal" tabindex="-1" id="myModal" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Novo Pedido</h5>
                <button type="button" class="" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
            </div>
            <div class="modal-body">
                <div>
                    <a href="/cadastros/cliente"><button type="button" class="success-button">Novo Cliente</button></a>
                </div>
                <br>
                <div class="row">
                    <input type="hidden" id="idMesa">
                    <label for="name">Cliente</label>
                    <select name="" id="name" style="width: 100% !important; font-size: 14px;">
                        <% clientes.forEach(function(cliente){%>
                            <option value="<%=cliente._id%>"><%=cliente.name%></option>
                           
                            <% });%>
                            
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="novoPedido();" class="success-button">Criar</button>
                <button type="button" class="mdl-button" onclick="closeClickHandler()" data-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function($) {
        $(".clickable-row").click(function() {
            // window.location = $(this).data("href");
        });
    });
</script>
<script>
    function showClickHandler(idMesa) {
        document.querySelector('#idMesa').value = idMesa;
        $('#myModal').modal('show');

    };

    function novoPedido() {
        let name = $('#name').val();
        $.ajax({
            method: 'PUT',
            url: "novo/" + name,
            data: {
                client: name,
                isDelivery: true
            },
            success: function() {
                window.location.reload(true);
            }
        })
    }

    function FinalizarPedido(idCaixa) {

        $.ajax({
            method: 'PUT',
            url: "finalizar/" + idCaixa,
            data: {
                caixa: idCaixa,
            },
            success: function() {
                window.location.reload(true);
            }
        })
    }

    function caixa(idCaixa) {
        window.location.href = "/financeiro/caixas/" + idCaixa;

    }

    function add(idCaixa) {
        window.location.href = "/list/categorias/" + idCaixa;

    }
</script>