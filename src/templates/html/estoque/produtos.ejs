<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produtos</title>
    <base href="/">
    <link rel="stylesheet" type="text/css" href="http://localhost:3000/templates/css/liststyle.css">
    <link rel="stylesheet" type="text/css" href="http://localhost:3000/templates/css/global.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Quicksand:400,700');
        *,
        *::before,
        *::after {
        box-sizing: border-box;
        }
    
        .main{
  max-width: 1200px;
  margin: 0 auto;
}

h1 {
    font-size: 24px;
    font-weight: 400;
    text-align: center;
}

img {
  height: auto;
  max-width: 100%;
  vertical-align: middle;
}

.btn {
  color: #ffffff;
  /* padding: 0.8rem; */
  font-size: 14px;
  text-transform: uppercase;
  border-radius: 4px;
  font-weight: 400;
  display: block;
  width: 100%;
  cursor: pointer;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: transparent;
}

.btn:hover {
  background-color: rgba(255, 255, 255, 0.12);
}

.cards {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
}

.cards_item {
  display: flex;
  padding: 1rem;
}

@media (min-width: 40rem) {
  .cards_item {
    width: 50%;
  }
}

@media (min-width: 56rem) {
  .cards_item {
    width: 33.3333%;
  }
}

.card {
  background-color: white;
  border-radius: 0.25rem;
  box-shadow: 0 20px 40px -14px rgba(0, 0, 0, 0.25);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  width: 100%;
}

.card_content {
  padding: 1rem;
  background: linear-gradient(to bottom left, #EF8D9C 40%, #FFC39E 100%);
}

.card_title {
  color: #ffffff;
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: 1px;
  padding: 0 !important;
  text-transform: capitalize;
  margin: 0px;
}

.card_text {
  color: #ffffff;
  font-size: 0.875rem;
  line-height: 1.5;
  margin-bottom: 1.25rem;    
  font-weight: 400;
}
.made_by{
  font-weight: 400;
  font-size: 13px;
  margin-top: 35px;
  text-align: center;
}


        dialog fieldset{
            border: none !important;
        }
        dialog label{
            color: black !important;
        }
        dialog input{
            background-color: white !important;
            color: black !important;
            border: 1px solid black !important;
        }
        .active{
            border-radius: 0 !important;
        }
        body div.container1 {
            height: auto !important;
            min-height: 100vh !important;
            align-items: initial !important;
        }

        h1 {
            font-size: 1.7rem;
            margin-top: 1rem;
            background: transparent !important;
            color: #bfbfbb;
            padding: 0.2em 1em;
            border-radius: 3px;
            border-left: solid transparent 0px !important;
            font-weight: 100;
            text-align: left !important;
        }
        .card_image{
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
    </style>
</head>
<body>
    <div class="notify"><span id="notifyType" class=""></span></div>
    <div class="container1">
        <div class="container-form">
            <div id="#responsive" class="itens">
                <div class="main">
                    <ul class="cards">
                    <% produtos.forEach(function(produto){ %>
                        <li class="cards_item">
                            <div class="card">
                              <div class="card_image"><img style="width: 75%;" src="/img/combo1.png"></div>
                              <div class="card_content">
                                <h1 class="card_title"><%=produto.name%></h1>
                                <p class="card_text">
                                    Código: <%=produto.codigo%> <br>
                                    Preço: <span class="money"><%=produto.precoVenda%></span>
                                </p>
                                <div>
                                    <%if(tipo==0){%>
                                        <button id="" class="btn card_btn" data-translate="start">Editar</button>
                                        <button id="" class="btn card_btn" data-translate="start">Desativar</button>
                                    <%}else{%>
                                        <button id="" class="btn card_btn" onclick="showClickHandler('<%=produto._id%>',<%=produto.quantidade%>)" data-translate="start">Adicionar</button>
                                    <%}%>
                                </div>
                                <!-- <button class="btn card_btn">Read More</button> -->
                              </div>
                            </div>
                          </li>
                    <%});%>
                </ul>
                </div>
                <!-- <table id="#responsive">
                    <thead>
                        <th>Código</th>
                        <th>Produto</th>
                        <th class="text-center">Qtde</th>
                        <th class="text-center">Valor</th>
                        <th class="text-center">Tipo</th>
                        <th class="text-center">Status</th>
                        <th style="width: 20%;">ações</th>
            
                    </thead>
                    <tbody>
                        <% produtos.forEach(function(produto){ %>
                            <tr>
                                <td><%=produto.codigo%></td>
                                <td><%=produto.name%></td>
                                <td class="text-center"><%=produto.quantidade%></td>
                                <td class="text-center"><%=produto.precoVenda%></td>
                                <td class="text-center"><%=(typeof produto.medida != 'undefined') ? produto.medida.sigla : ''%></td>
                                <td class="text-center"><%=(produto.ativo) ? "ativo":"inativo"%></td>
                                <td>
                                    <%if(tipo==0){%>
                                        <button id="" class="select" data-translate="start">Editar</button>
                                        <button id="" class="select" data-translate="start">Desativar</button>
                                    <%}else{%>
                                        <button id="" class="select" onclick="showClickHandler('<%=produto._id%>',<%=produto.quantidade%>)" data-translate="start">Adicionar</button>
                                    <%}%>
                                </td>
                            </tr>
                          <% }); %>
                    </tbody>
                </table> -->
            </div>
        </div>
    </div>

    <%if(tipo==1){%>
        <dialog class="mdl-dialog" id="modal-example">
            <input type="hidden" id="idProduto">
            <input type="hidden" id="qtdeDisponivel">
            <input type="hidden" name="idCaixa" id="idCaixa" value="<%=idCaixa%>">
            <div class="mdl-dialog__content">
                <div class="row">
                    <fieldset class='float-label-field'>
                        <label for="name">Disponivel: </label>
                        <label for="" id="disponivel">1</label>
                    </fieldset>
                </div> 
                <div class="row">
                    <fieldset class='float-label-field'>
                        <label for="quantidade">Quantidade</label>
                        <input style="width: 100% !important;" id="quantidade" value="1" class='text' required name="quantidade" type='text'>
                    </fieldset>
                </div>  
            </div>
            <div class="mdl-dialog__actions mdl-dialog__actions--full-width">
                <div class="container-button left">
                    <button onclick="closeClickHandler();" type="button" class="mdl-button">Close</button>
                </div>
                <div class="container-button right">
                    <button type="button" onclick="addProduto();" class="mdl-button">Adicionar</button>
                </div>
            </div>
        </dialog>

        <script>
            var dialog = document.querySelector('#modal-example');
            if (! dialog.showModal) {
                dialogPolyfill.registerDialog(dialog);
            }
            function closeClickHandler() {
                dialog.close();
            };
            function showClickHandler(idProduto,quantidade) {
                dialog.querySelector('#idProduto').value = idProduto;
                dialog.querySelector('#qtdeDisponivel').value = idProduto;
                dialog.querySelector('#disponivel').innerHTML = quantidade;
                dialog.showModal();
            };

            function addProduto(){
            let idCaixa = document.querySelector('#idCaixa');
            let quantidade = document.querySelector('#quantidade');
            let idProduto = document.querySelector('#idProduto');
            let data = {
                quantidade: quantidade.value,
                idProduto: idProduto.value
            };

            $.ajax({
                type: 'PUT',
                url: 'http://localhost:3000/financeiro/addproduto/'+idCaixa.value,
                contentType: 'application/json',
                data: JSON.stringify(data), // access in body
            }).done(function (data) {
                console.log("Sucess");
                sucess();
                closeClickHandler();
            }).fail(function (msg) {
                console.log('FAIL');
                failure();
            }).always(function (msg) {
                console.log('ALWAYS');
            });
            }


            function sucess(){
                $(".notify").toggleClass("active");
                $(".notify").toggleClass("success");
                $("#notifyType").html("Adicionado com Sucesso!");
                $(".notify").show();
                
                setTimeout(function(){
                    $(".notify").removeClass("active");
                    $(".notify").removeClass("success");
                    $(".notify").hide();
                },5000);
            }
            function failure(){
                $(".notify").addClass("active");
                $(".notify").addClass("failure");
                $("#notifyType").html("Error ao adicionar!");
                $(".notify").show();
                
                setTimeout(function(){
                    $(".notify").removeClass("active");
                    $(".notify").removeClass("failure");
                    $(".notify").hide();
                },5000);
            }
        </script>

    <%}%>

    <script>
        var formatter = new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
            });
            let moneys = document.querySelectorAll('.money');
            for (let index = 0; index < moneys.length; index++) {
                const element = moneys[index];
                console.log(element, element.innerText);
                element.innerHTML = formatter.format(element.innerHTML);
            }
    </script>
    
</body>
</html>